<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Christmas Pixel Art Game</title>
    <style>
        body {
            margin: 0;
            background-color: #1d3557;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
        }
        canvas {
            background-color: #457b9d;
            border: 4px solid #f4a261;
            display: block;
            touch-action: none; /* Prevent scrolling when touching canvas */
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="400" height="400"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // Adjust canvas size for mobile devices
        function resizeCanvas() {
            const size = Math.min(window.innerWidth, window.innerHeight) - 20;
            canvas.width = size;
            canvas.height = size;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // Game Variables
        const santa = {
            x: canvas.width / 2 - 20,
            y: canvas.height - 80,
            width: 40,
            height: 40,
            color: 'red',
            dx: 0,
        };
        const gifts = [];
        const obstacles = [];
        const powers = [];
        let score = 0;
        let isGameOver = false;
        let gameSpeed = 2;
        const winScore = 200;

        function createGift() {
            const gift = {
                x: Math.random() * (canvas.width - 20),
                y: 0,
                width: 20,
                height: 20,
                color: 'green',
                dy: gameSpeed,
            };
            gifts.push(gift);
        }

        function createObstacle() {
            const obstacle = {
                x: Math.random() * (canvas.width - 40),
                y: 0,
                width: 40,
                height: 20,
                color: 'brown',
                dy: gameSpeed + 1,
            };
            obstacles.push(obstacle);
        }

        function createPower() {
            const power = {
                x: Math.random() * (canvas.width - 30),
                y: 0,
                width: 30,
                height: 30,
                color: Math.random() > 0.5 ? 'blue' : 'yellow',
                dy: gameSpeed - 0.5,
                effect: Math.random() > 0.5 ? () => { gameSpeed -= 1; } : () => { score += 20; },
            };
            powers.push(power);
        }

        function drawSanta() {
            ctx.fillStyle = santa.color;
            ctx.fillRect(santa.x, santa.y, santa.width, santa.height);
        }

        function drawGifts() {
            gifts.forEach(gift => {
                ctx.fillStyle = gift.color;
                ctx.fillRect(gift.x, gift.y, gift.width, gift.height);
            });
        }

        function drawObstacles() {
            obstacles.forEach(obstacle => {
                ctx.fillStyle = obstacle.color;
                ctx.fillRect(obstacle.x, obstacle.y, obstacle.width, obstacle.height);
            });
        }

        function drawPowers() {
            powers.forEach(power => {
                ctx.fillStyle = power.color;
                ctx.fillRect(power.x, power.y, power.width, power.height);
            });
        }

        function drawScore() {
            ctx.fillStyle = 'white';
            ctx.font = '20px Arial';
            ctx.fillText(`Score: ${score}`, 10, 30);
        }

        function moveSanta() {
            santa.x += santa.dx;
            if (santa.x < 0) santa.x = 0;
            if (santa.x + santa.width > canvas.width) santa.x = canvas.width - santa.width;
        }

        function moveObjects() {
            gifts.forEach(gift => gift.y += gift.dy);
            obstacles.forEach(obstacle => obstacle.y += obstacle.dy);
            powers.forEach(power => power.y += power.dy);
        }

        function checkCollisions() {
            gifts.forEach((gift, index) => {
                if (
                    santa.x < gift.x + gift.width &&
                    santa.x + santa.width > gift.x &&
                    santa.y < gift.y + gift.height &&
                    santa.y + santa.height > gift.y
                ) {
                    gifts.splice(index, 1);
                    score += 10;
                    if (score % 20 === 0) gameSpeed += 0.5;
                }
            });

            obstacles.forEach(obstacle => {
                if (
                    santa.x < obstacle.x + obstacle.width &&
                    santa.x + santa.width > obstacle.x &&
                    santa.y < obstacle.y + obstacle.height &&
                    santa.y + santa.height > obstacle.y
                ) {
                    isGameOver = true;
                }
            });

            powers.forEach((power, index) => {
                if (
                    santa.x < power.x + power.width &&
                    santa.x + santa.width > power.x &&
                    santa.y < power.y + power.height &&
                    santa.y + santa.height > power.y
                ) {
                    powers.splice(index, 1);
                    power.effect();
                }
            });
        }

        function cleanupObjects() {
            gifts.filter(gift => gift.y <= canvas.height);
            obstacles.filter(obstacle => obstacle.y <= canvas.height);
            powers.filter(power => power.y <= canvas.height);
        }

        function update() {
            if (isGameOver) {
                ctx.fillStyle = 'white';
                ctx.font = '30px Arial';
                ctx.fillText('Game Over!', canvas.width / 4, canvas.height / 2);
                return;
            }

            if (score >= winScore) {
                ctx.fillStyle = 'yellow';
                ctx.font = '30px Arial';
                ctx.fillText('You Win!', canvas.width / 4, canvas.height / 2);
                return;
            }

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawSanta();
            drawGifts();
            drawObstacles();
            drawPowers();
            drawScore();
            moveSanta();
            moveObjects();
            checkCollisions();
            cleanupObjects();

            requestAnimationFrame(update);
        }

        // Touch controls for mobile
        let touchStartX = 0;
        canvas.addEventListener('touchstart', (e) => {
            touchStartX = e.touches[0].clientX;
        });

        canvas.addEventListener('touchmove', (e) => {
            const touchX = e.touches[0].clientX;
            const deltaX = touchX - touchStartX;
            santa.dx = deltaX / 10;
        });

        canvas.addEventListener('touchend', () => {
            santa.dx = 0;
        });

        // Game Loop
        setInterval(createGift, 2000);
        setInterval(createObstacle, 3000);
        setInterval(createPower, 7000);
        update();
    </script>
</body>
</html>
